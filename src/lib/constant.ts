import { type Matrix, matrix } from "mathjs";
import type { Illuminants, Observers } from "@/lib/types";

const STDOBSERV_X2 = [
	0.0, 0.0, 0.0001299, 0.0004149, 0.001368, 0.004243, 0.01431, 0.04351, 0.13438, 0.2839, 0.34828,
	0.3362, 0.2908, 0.19536, 0.09564, 0.03201, 0.0049, 0.0093, 0.06327, 0.1655, 0.2904, 0.4334499,
	0.5945, 0.7621, 0.9163, 1.0263, 1.0622, 1.0026, 0.8544499, 0.6424, 0.4479, 0.2835, 0.1649, 0.0874,
	0.04677, 0.0227, 0.01135916, 0.005790346, 0.002899327, 0.001439971, 0.0006900786, 0.0003323011,
	0.0001661505, 0.00008307527, 0.00004150994, 0.00002067383, 0.00001025398, 0.000005085868,
	0.000002522525, 0.000001251141,
] as const;

const STDOBSERV_Y2 = [
	0.0, 0.0, 0.000003917, 0.00001239, 0.000039, 0.00012, 0.000396, 0.00121, 0.004, 0.0116, 0.023,
	0.038, 0.06, 0.09098, 0.13902, 0.20802, 0.323, 0.503, 0.71, 0.862, 0.954, 0.9949501, 0.995, 0.952,
	0.87, 0.757, 0.631, 0.503, 0.381, 0.265, 0.175, 0.107, 0.061, 0.032, 0.017, 0.00821, 0.004102,
	0.002091, 0.001047, 0.00052, 0.0002492, 0.00012, 0.00006, 0.00003, 0.00001499, 0.0000074657,
	0.0000037029, 0.0000018366, 0.00000091093, 0.00000045181,
] as const;

const STDOBSERV_Z2 = [
	0.0, 0.0, 0.0006061, 0.001946, 0.006450001, 0.02005001, 0.06785001, 0.2074, 0.6456, 1.3856,
	1.74706, 1.77211, 1.6692, 1.28764, 0.8129501, 0.46518, 0.272, 0.1582, 0.07824999, 0.04216, 0.0203,
	0.008749999, 0.0039, 0.0021, 0.001650001, 0.0011, 0.0008, 0.00034, 0.00019, 0.00004999999,
	0.00002, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
	0.0,
] as const;

const STDOBSERV_X10 = [
	0.0, 0.0, 0.0000001222, 0.0000059586, 0.000159952, 0.0023616, 0.0191097, 0.084736, 0.204492,
	0.314679, 0.383734, 0.370702, 0.302273, 0.195618, 0.080507, 0.016172, 0.003816, 0.037465,
	0.117749, 0.236491, 0.376772, 0.529826, 0.705224, 0.878655, 1.01416, 1.11852, 1.12399, 1.03048,
	0.856297, 0.647467, 0.431567, 0.268329, 0.152568, 0.0812606, 0.0408508, 0.0199413, 0.00957688,
	0.00455263, 0.00217496, 0.00104476, 0.000508258, 0.000250969, 0.00012639, 0.0000645258,
	0.0000334117, 0.0000176115, 0.00000941363, 0.00000509347, 0.00000279531, 0.00000155314,
] as const;

const STDOBSERV_Y10 = [
	0.0, 0.0, 0.000000013398, 0.0000006511, 0.000017364, 0.0002534, 0.0020044, 0.008756, 0.021391,
	0.038676, 0.062077, 0.089456, 0.128201, 0.18519, 0.253589, 0.339133, 0.460777, 0.606741, 0.761757,
	0.875211, 0.961988, 0.991761, 0.99734, 0.955552, 0.868934, 0.777405, 0.658341, 0.527963, 0.398057,
	0.283493, 0.179828, 0.107633, 0.060281, 0.0318004, 0.0159051, 0.0077488, 0.00371774, 0.00176847,
	0.00084619, 0.00040741, 0.00019873, 0.000098428, 0.000049737, 0.000025486, 0.000013249,
	0.0000070128, 0.00000376473, 0.00000204613, 0.00000112809, 0.0000006297,
] as const;

const STDOBSERV_Z10 = [
	0.0, 0.0, 0.000000535027, 0.0000261437, 0.000704776, 0.0104822, 0.0860109, 0.389366, 0.972542,
	1.55348, 1.96728, 1.9948, 1.74537, 1.31756, 0.772125, 0.415254, 0.218502, 0.112044, 0.060709,
	0.030451, 0.013676, 0.003988, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
	0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
] as const;

const REFERENCE_ILLUM_D50 = [
	17.92, 20.98, 23.91, 25.89, 24.45, 29.83, 49.25, 56.45, 59.97, 57.76, 74.77, 87.19, 90.56, 91.32,
	95.07, 91.93, 95.7, 96.59, 97.11, 102.09, 100.75, 102.31, 100.0, 97.74, 98.92, 93.51, 97.71,
	99.29, 99.07, 95.75, 98.9, 95.71, 98.24, 103.06, 99.19, 87.43, 91.66, 92.94, 76.89, 86.56, 92.63,
	78.27, 57.72, 82.97, 78.31, 79.59, 73.44, 63.95, 70.81, 74.48,
] as const;

const REFERENCE_ILLUM_D65 = [
	39.9, 44.86, 46.59, 51.74, 49.92, 54.6, 82.69, 91.42, 93.37, 86.63, 104.81, 116.96, 117.76,
	114.82, 115.89, 108.78, 109.33, 107.78, 104.78, 107.68, 104.4, 104.04, 100.0, 96.34, 95.79, 88.69,
	90.02, 89.61, 87.71, 83.3, 83.72, 80.05, 80.24, 82.3, 78.31, 69.74, 71.63, 74.37, 61.62, 69.91,
	75.11, 63.61, 46.43, 66.83, 63.4, 64.32, 59.47, 51.97, 57.46, 60.33,
] as const;

export const REF_STDOBSERV_TABLE: Record<
	Observers,
	{ x: readonly number[]; y: readonly number[]; z: readonly number[] }
> = {
	"2": { x: STDOBSERV_X2, y: STDOBSERV_Y2, z: STDOBSERV_Z2 },
	"10": { x: STDOBSERV_X10, y: STDOBSERV_Y10, z: STDOBSERV_Z10 },
};

export const REF_ILLUM_TABLE: Record<Illuminants, readonly number[]> = {
	d50: REFERENCE_ILLUM_D50,
	d65: REFERENCE_ILLUM_D65,
};

/** Warto≈õci bieli  */
export const ILLUMINANTS: Record<Observers, Record<Illuminants, Matrix>> = {
	"2": {
		d50: matrix([0.96422, 1.0, 0.82521]), //[96.4212, 100.0, 82.5188]
		d65: matrix([0.95047, 1.0, 1.08883]), //[95.0489, 100.0, 108.8840]
	},
	"10": {
		d50: matrix([0.9672, 1.0, 0.8143]),
		d65: matrix([0.9481, 1.0, 1.073]),
	},
} as const;

/** Macierze adaptacji barwnej Bradforda */
export const ADAPTATIONS: Record<string, Matrix> = {
	bradford: matrix([
		[0.8951, 0.2664, -0.1614],
		[-0.7502, 1.7135, 0.0367],
		[0.0389, -0.0685, 1.0296],
	]),
} as const;
